<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>clever.txt ‚òòÔ∏è</title>
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300;700&family=Montserrat:wght@400;900&family=Playfair+Display&family=Kelly+Slab&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #f4f7f6; --accent: #27ae60; }
        body { margin: 0; background: var(--bg); font-family: 'Montserrat', sans-serif; display: flex; flex-direction: column; height: 100vh; }
        
        .header { background: #fff; padding: 10px 20px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid #ddd; }
        .logo { font-weight: 900; font-size: 1.5rem; color: var(--accent); display: flex; align-items: center; gap: 10px; }
        .logo-box { width: 30px; height: 30px; background: var(--accent); border-radius: 6px; rotate: 45deg; }
        
        .toolbar { background: #fff; padding: 10px; display: flex; gap: 10px; flex-wrap: wrap; border-bottom: 1px solid #ddd; position: sticky; top: 0; z-index: 10; justify-content: center; }
        .btn-group { display: flex; gap: 5px; background: #f9f9f9; padding: 5px; border-radius: 8px; }
        
        button, select { border: 1px solid #eee; background: white; padding: 8px; border-radius: 5px; cursor: pointer; font-size: 14px; }
        button:hover { background: var(--accent); color: white; border-color: var(--accent); }
        
        .viewport { flex: 1; overflow-y: auto; padding: 40px 20px; display: flex; justify-content: center; }
        #editor { 
            width: 210mm; min-height: 297mm; background: white; padding: 20mm; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.05); outline: none; box-sizing: border-box; 
            line-height: 1.6; font-size: 12pt; transition: 0.3s;
        }

        .share-panel { font-size: 12px; display: flex; flex-direction: column; gap: 5px; }
        .share-url { font-family: monospace; background: #eee; padding: 5px; border-radius: 4px; border: 1px solid #ccc; width: 250px; }
        
        /* –°—Ç–∏–ª–∏ –±—É–º–∞–≥–∏ */
        .lined { background-image: repeating-linear-gradient(#fff, #fff 31px, #eef0f1 32px); }
        .grid { background-image: radial-gradient(#d1d1d1 1px, transparent 1px); background-size: 25px 25px; }
        
        [contenteditable="false"] { cursor: default; }
    </style>
</head>
<body>

<div class="header">
    <div class="logo"><div class="logo-box"></div> clever.txt</div>
    <div class="share-panel">
        <div>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: <input class="share-url" id="edit-url" readonly></div>
        <div>–¢–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä: <input class="share-url" id="view-url" readonly></div>
    </div>
</div>

<div class="toolbar" id="main-toolbar">
    <div class="btn-group">
        <select onchange="document.execCommand('fontName', false, this.value)">
            <option value="Montserrat">Montserrat</option>
            <option value="Kelly Slab">Kelly Slab</option>
            <option value="Playfair Display">Playfair</option>
            <option value="Courier New">Monospace</option>
        </select>
        <input type="color" oninput="document.execCommand('foreColor', false, this.value)" title="–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞">
    </div>
    <div class="btn-group">
        <button onclick="document.execCommand('bold')"><b>B</b></button>
        <button onclick="document.execCommand('italic')"><i>I</i></button>
        <button onclick="document.execCommand('insertUnorderedList')">‚Ä¢ –°–ø–∏–æ–∫</button>
        <button onclick="const url = prompt('URL —Ñ–æ—Ç–æ:'); if(url) document.execCommand('insertImage', false, url)">üñº –§–æ—Ç–æ</button>
    </div>
    <div class="btn-group">
        <button onclick="document.getElementById('editor').className = 'lined'">–õ–∏–Ω–∏–∏</button>
        <button onclick="document.getElementById('editor').className = 'grid'">–ö–ª–µ—Ç–∫–∞</button>
        <button onclick="document.getElementById('editor').className = ''">–ß–∏—Å—Ç—ã–π</button>
    </div>
    <button onclick="saveDoc()" id="save-btn" style="background: var(--accent); color: white;">–°–û–•–†–ê–ù–ò–¢–¨ –í –û–ë–õ–ê–ö–û</button>
</div>

<div class="viewport">
    <div id="editor" contenteditable="true" class="lined">
        <h1>–¢–≤–æ–π –Ω–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç üçÄ</h1>
        <p>–ù–∞—á–Ω–∏ –ø–∏—Å–∞—Ç—å –¥–µ—Ä–∑–∫–æ. –í—Å–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –ø–æ —Å—Å—ã–ª–∫–µ —Å–≤–µ—Ä—Ö—É.</p>
    </div>
</div>

<script>
    const API_BASE = "https://unharrowed-darleen-dismayingly.ngrok-free.dev";
    const editor = document.getElementById('editor');
    
    // –†–∞–±–æ—Ç–∞ —Å URL
    const params = new URLSearchParams(window.location.search);
    let docId = params.get('id');
    const isViewOnly = params.get('view') === 'true';

    // –ï—Å–ª–∏ ID –Ω–µ—Ç ‚Äî —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π
    if (!docId) {
        docId = 'doc_' + Math.random().toString(36).substr(2, 9);
        window.history.replaceState(null, '', `?id=${docId}`);
    }

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Å—ã–ª–æ–∫
    const currentBase = window.location.origin + window.location.pathname;
    document.getElementById('edit-url').value = `${currentBase}?id=${docId}`;
    document.getElementById('view-url').value = `${currentBase}?id=${docId}&view=true`;

    // –†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
    if (isViewOnly) {
        editor.contentEditable = "false";
        document.getElementById('main-toolbar').style.display = "none";
        document.title = "–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞ | clever.txt";
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    async function loadDoc() {
        try {
            const res = await fetch(`${API_BASE}/load/${docId}`);
            const data = await res.json();
            if (data.content) editor.innerHTML = data.content;
        } catch (e) { console.log("–î–æ–∫—É–º–µ–Ω—Ç –Ω–æ–≤—ã–π –∏–ª–∏ —Å–µ—Ä–≤–µ—Ä —Å–ø–∏—Ç"); }
    }

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
    async function saveDoc() {
        const btn = document.getElementById('save-btn');
        btn.innerText = "–°–û–•–†–ê–ù–Ø–ï–ú...";
        try {
            await fetch(`${API_BASE}/save`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ id: docId, content: editor.innerHTML })
            });
            btn.innerText = "–°–û–•–†–ê–ù–ï–ù–û! ‚òòÔ∏è";
        } catch (e) {
            btn.innerText = "–û–®–ò–ë–ö–ê –°–ï–†–í–ï–†–ê";
            console.error(e);
        }
        setTimeout(() => btn.innerText = "–°–û–•–†–ê–ù–ò–¢–¨ –í –û–ë–õ–ê–ö–û", 2000);
    }

    loadDoc();
</script>
</body>
</html>